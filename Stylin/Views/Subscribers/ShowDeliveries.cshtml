@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}


<div>
    <button id="getData">Get Data</button>

    <div id="map">
        
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>


 
    $("#getData").click(function () {

        let address = [];

        $.ajax(
            {
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                dataType: 'JSON',
                url: '/Subscribers/SubscribersWithPackage',
                success:
                    function (response) {
                        debugger;
                        for (let i = 0; i < response.length; i++) {
                            let adr = response[i].address + response[i].city + response[i].zipCode + response[i].state;
                            address.push(adr);
                        }
                    },
                error:
                    function (response) {
                        debugger;
                        alert("Error: " + response);
                    }
            });

        //Calling ajax to get LatLong of application
        let latlng = { lat: 0, lng: 0 };
        let latLong = [];

        for (let k = 0; k < address.length; k++) {

            $.ajax({
                url: "https://maps.googleapis.com/maps/api/geocode/json?address=" + address[k] + "&key=AIzaSyC2Uyq82S9tdxWSHz4c4eI4E1IEHqjkaFg",

            }).done(function (response) {

                //Code here to show multiple maps

                latlng.lng = response.results[0].geometry.location.lng;
                latlng.lat = response.response[0].geometry.location.lat;

                let newCopy = { ...latlng };

                latLong.push(newCopy);
                localStorage.setItem('LatLongs', JSON.stringify(latlngs));
            });
            latLongs.lat = response.results[0].geometry.location.lat
        }

        //Show Google Map here\\


        let data = JSON.parse(localStorage.getItem("LatLongs"));
        loadMap(data);


    })


    function loadMap(latlngs) {

        let map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            center: new google.maps.LatLng(34.274647, -119.229034),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });


        var infowindow = new google.maps.InfoWindow();

        var marker;

        for (let k = 0; k < latlngs.length; k++) {
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(latlngs[k].lat, latlngs[k].lng),
                map: map
            });

            marker.setMap(map);

            google.maps.event.addListener(marker, 'click', (function (marker, k) {
                return function () {
                    infowindow.setContent("hello checking");
                    infowindow.open(map, marker);
                }
            })(marker, k));
        }

        console.log(latlngs);
    }

</script>